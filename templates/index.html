<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Node Balances and Metrics</title>
    <style>
        @font-face {
            font-family: 'Proxima Nova Alt Bold';
            src: url('https://cdn.example.com/proxima-nova-alt-bold.woff2') format('woff2');
            font-weight: bold;
            font-style: normal;
        }

        body {
            background-color: #000000;
            color: #FFFFFF;
            font-family: 'Proxima Nova Alt Bold', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            text-align: center;
        }

        h1 {
            color: #9b59b6;
            font-size: 28px;
            margin-bottom: 15px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }

        table, th, td {
            border: 1px solid #ccc;
        }

        th, td {
            padding: 10px;
            text-align: center;
        }

        th {
            background-color: #9b59b6;
            color: white;
        }

        footer {
            margin-top: 30px;
            font-size: 14px;
            color: #666;
        }

        .wallets {
            margin-top: 20px;
        }

        .wallets .wallet-address {
            font-weight: bold;
        }

        .wallets p {
            margin: 10px 0;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 34px;
            height: 20px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 12px;
            width: 12px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: #9b59b6;
        }

        input:checked + .slider:before {
            transform: translateX(14px);
        }

        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

    </style>
    <script>
        // Set a timer to refresh the page every 75 seconds, unless auto-refresh is turned off
        let autoRefresh = true;

        function toggleRefresh() {
            autoRefresh = !autoRefresh;
        }

        function refreshPage() {
            if (autoRefresh) {
                window.location.reload();
            }
        }

        setInterval(refreshPage, 75000);  // 75 seconds in milliseconds

        function loadCustomNodeNames() {
            const nodes = document.querySelectorAll('.node-input');
            nodes.forEach(node => {
                const storedName = localStorage.getItem(node.id);
                if (storedName) {
                    node.value = storedName;
                }
                node.addEventListener('input', (e) => {
                    localStorage.setItem(e.target.id, e.target.value);
                });
            });
        }

        function toggleNightMode() {
            const urlParams = new URLSearchParams(window.location.search);
            const nightMode = urlParams.get('night_mode') === 'on' ? 'off' : 'on';
            window.location.href = `/?night_mode=${nightMode}`;
        }

        document.addEventListener("DOMContentLoaded", loadCustomNodeNames);
    </script>
</head>
<body>
    <!-- Display the total balance of all peers -->
    <h1>Total Quil Across All Peers: {{ total_balance }} Quil</h1>

    <!-- Display the current wQUIL price -->
    <h1>Current wQUIL Price</h1>
    <p>Price in USD: ${{ wquil_price }}</p>

    <!-- Night Mode and Auto-Refresh Switches -->
    <div style="text-align: right; margin-bottom: 20px;">
        <label for="nightMode">Night Mode</label>
        <label class="switch">
            <input type="checkbox" id="nightMode" {% if night_mode == 'on' %}checked{% endif %} onclick="toggleNightMode()">
            <span class="slider"></span>
        </label>

        <label for="autoRefresh" style="margin-left: 20px;">Auto Refresh</label>
        <label class="switch">
            <input type="checkbox" id="autoRefresh" checked onclick="toggleRefresh()">
            <span class="slider"></span>
        </label>
    </div>

    <!-- Display Node Statistics table -->
    <h1>Node Statistics</h1>
    <table>
        <thead>
            <tr>
                <th>Node</th>
                <th>Peer ID</th>
                <th>Quil Balance</th>
                <th>Quil Per Minute</th>
                <th>Quil Per Hour</th>
                <th>$ Per Hour</th>
                <th>Quil Per Day</th>
                <th>$ Per Day</th>
            </tr>
        </thead>
        <tbody>
            {% for row in table_data %}
            <tr>
                <td><input type="text" class="node-input" id="node-{{ loop.index }}" placeholder="Enter Node Name"></td>
                <td>{{ row['Peer ID'] }}</td>
                <td>{{ "{:.4f}".format(row['Balance'] | default(0.0)) }}</td>
                <td>{{ "{:.4f}".format(row['Quil Per Minute'] | default(0.0)) }}</td>
                <td>{{ "{:.4f}".format(row['Quil Per Hour'] | default(0.0)) }}</td>
                <td>${{ "{:.4f}".format(row['$ Per Hour'] | default(0.0)) }}</td>
                <td>{{ "{:.4f}".format(row['Quil Per Day'] | default(0.0)) }}</td>
                <td>${{ "{:.4f}".format(row['$ Per Day'] | default(0.0)) }}</td>
            </tr>
            {% endfor %}
            <!-- Totals row -->
            <tr>
                <td>Total</td>
                <td></td>
                <td>{{ "{:.4f}".format(total_quil_balance | default(0.0)) }}</td>
                <td>{{ "{:.4f}".format(total_quil_per_minute | default(0.0)) }}</td>
                <td>{{ "{:.4f}".format(total_quil_per_hour | default(0.0)) }}</td>
                <td>${{ "{:.4f}".format(total_dollar_per_hour | default(0.0)) }}</td> <!-- Added $ sign -->
                <td>{{ "{:.4f}".format(total_quil_per_day | default(0.0)) }}</td>
                <td>${{ "{:.4f}".format(total_dollar_per_day | default(0.0)) }}</td> <!-- Added $ sign -->
             </tr>
        </tbody>
    </table>

    <!-- Display the interactive Plotly charts -->
    <h1>Node Balances Over Time</h1>
    <div>{{ balance_graph_html | safe }}</div>

    <h1>Quil Earned Per Minute</h1>
    <div>{{ quil_minute_graph_html | safe }}</div>

    <h1>Hourly Growth in Quil</h1>
    <div>{{ hourly_growth_graph_html | safe }}</div>

    <h1>Earnings in USD per Hour</h1>
    <div>{{ earnings_per_hour_graph_html | safe }}</div>

    <h1>Earnings in USD per Minute</h1>
    <div>{{ earnings_per_minute_graph_html | safe }}</div>

    <!-- Footer with wallet details -->
    <footer>
        <p>Data visualized from your node logs.</p>
        <div class="wallets">
            <p>Buy me a Coffee (Ethereum): <span class="wallet-address">0x705242cF0ec57707ed96163D324e5c1caA9f781C</span></p>
            <p class="solana-address">Solana: <span class="wallet-address">9TiE9BWnkFuhudv39uDZPdpoxzBhKnCWrQ1Qx5iyjuSg</span></p>
        </div>
        <p>For more information, visit <a href="https://status.quilibrium.com/" style="color: #9b59b6;">Quilibrium Status</a>.</p>
        <p>Rent amazing servers at <a href="https://www.cherryservers.com/?affiliate=Z912GG75" style="color: #9b59b6;">Cherry Servers</a>.</p>
    </footer>
</body>
</html>
